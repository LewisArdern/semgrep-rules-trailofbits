rules:
  - id: postgres-insecure-sslmode
    message: |
      Found PostgreSQL connection string disabling SSL verification
    languages: [regex]
    severity: WARNING
    metadata:
      category: security
      subcategory: [audit]
      cwe: "CWE-319: Cleartext Transmission of Sensitive Information"
      confidence: HIGH
      likelihood: HIGH
      impact: HIGH
      technology: [postgresql]
      references:
        - https://www.postgresql.org/docs/current/libpq-connect.html
    # pattern-regex: "[?&]sslmode=(disable|allow|prefer)"
    pattern-either:
      - patterns:
          - pattern-regex: postgresql://.+$
          - pattern-not-regex: (?:(.)?)?postgresql://.+[?&]sslmode=(require|verify-ca|verify-full)(?:\g{1}|$|&).*
          - pattern-not-regex: (?:(.)?)?postgresql://.+[?&]requiressl=1(?:\g{1}|$|&).*
          - pattern-not-regex: (?:(.)?)?postgresql://.+[?&]ssl=true(?:\g{1}|$|&).*
      - pattern-regex: postgresql://.+[?&]sslmode=(disable|allow|prefer).*$
      - pattern-regex: postgresql://.+[?&]requiressl=0.*$
      - pattern-regex: postgresql://.+[?&]ssl=false.*$
