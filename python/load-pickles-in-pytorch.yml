rules:
- id: load-pickles-in-pytorch
  patterns:
    - pattern-either:
      - pattern: torch.save(...)
      - pattern: torch.load(...)
    - pattern-not: torch.save($M.state_dict(), ...)
    - pattern-not-inside: $M.load_state_dict(torch.load($P))
  message: | 
    Avoid using functions reliant on pickling as it can lead to arbitrary code execution. If pickle is necessary, load from state_dict or use fickling. 
    Else, consider using a safer serialization method like HDF5 or ONNX. For more information, see https://www.trailofbits.com/post/never-a-dill-moment-exploiting-machine-learning-pickle-files
  languages: [python]
  severity: WARNING
