rules:
- id: waitgroup-wait-inside-loop
  patterns:
    - pattern-either: 
      - pattern: |
          var $WG sync.WaitGroup
          ...
          for ... {
            ...
            go func(...){
              ...
              defer $WG.Done()
              ...
            }()
            ...
            $WG.Wait()
            ...
          }
      - pattern: |
          $WG := &sync.WaitGroup{}
          ...
          for ... {
            ...
            go func(...){
              ...
              defer $WG.Done()
              ...
            }()
            ...
            $WG.Wait()
            ...
          }
  message: |
    Calling `$WG.Wait()` inside a loop blocks the call to `$WG.Done()`
  languages: [go]
  severity: WARNING
